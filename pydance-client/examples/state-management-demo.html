<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pydance State Management Demo</title>
  <style>
    body { font-family: system-ui; max-width: 800px; margin: 40px auto; padding: 20px; }
    .demo { border: 1px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 8px; }
    button { padding: 8px 16px; margin: 4px; cursor: pointer; }
    .count { font-size: 24px; font-weight: bold; margin: 10px 0; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>ðŸš€ Pydance State Management Demo</h1>

  <div class="demo">
    <h2>1. Zustand-style Store</h2>
    <div id="zustand-demo"></div>
  </div>

  <div class="demo">
    <h2>2. RTK-style Store with Slices</h2>
    <div id="rtk-demo"></div>
  </div>

  <div class="demo">
    <h2>3. Immer Integration</h2>
    <div id="immer-demo"></div>
  </div>

  <div class="demo">
    <h2>4. Persist & DevTools</h2>
    <div id="persist-demo"></div>
    <p><small>Open Redux DevTools to see state changes</small></p>
  </div>

  <script type="module">
    import { create, persist, devtools, immer, createSlice, configureStore } from '~/core/ModernStore.js';
    import { createComponent, jsx } from '~/core/Component.js';

    // Demo 1: Zustand-style
    const useCounterStore = create((set, get) => ({
      count: 0,
      increment: () => set(state => ({ count: state.count + 1 })),
      decrement: () => set(state => ({ count: state.count - 1 })),
      reset: () => set({ count: 0 })
    }));

    const ZustandDemo = createComponent(() => {
      const store = useCounterStore;
      const state = store.getState();

      store.subscribe(() => {
        const newState = store.getState();
        document.querySelector('#zustand-count').textContent = newState.count;
      });

      return jsx('div', {
        children: [
          jsx('div', { className: 'count', id: 'zustand-count', children: state.count }),
          jsx('button', { onClick: state.increment, children: '+ Increment' }),
          jsx('button', { onClick: state.decrement, children: '- Decrement' }),
          jsx('button', { onClick: state.reset, children: 'â†» Reset' })
        ]
      });
    });

    // Demo 2: RTK-style
    const counterSlice = createSlice({
      name: 'counter',
      initialState: { value: 0 },
      reducers: {
        increment: (state) => ({ ...state, value: state.value + 1 }),
        decrement: (state) => ({ ...state, value: state.value - 1 }),
        incrementByAmount: (state, action) => ({ ...state, value: state.value + action.payload })
      }
    });

    const rtkStore = configureStore({
      reducer: { counter: counterSlice }
    });

    const RTKDemo = createComponent(() => {
      const state = rtkStore.getState();

      rtkStore.subscribe(() => {
        const newState = rtkStore.getState();
        document.querySelector('#rtk-count').textContent = newState.counter.value;
      });

      return jsx('div', {
        children: [
          jsx('div', { className: 'count', id: 'rtk-count', children: state.counter.value }),
          jsx('button', { 
            onClick: () => rtkStore.dispatch(counterSlice.actions.increment()), 
            children: '+ Increment' 
          }),
          jsx('button', { 
            onClick: () => rtkStore.dispatch(counterSlice.actions.decrement()), 
            children: '- Decrement' 
          }),
          jsx('button', { 
            onClick: () => rtkStore.dispatch(counterSlice.actions.incrementByAmount(5)), 
            children: '+5' 
          })
        ]
      });
    });

    // Demo 3: Immer
    const useImmerStore = create(
      immer((set) => ({
        nested: { deep: { value: 0 } },
        updateDeep: () => set(state => {
          state.nested.deep.value += 1; // Mutate directly!
        })
      }))
    );

    const ImmerDemo = createComponent(() => {
      const store = useImmerStore;
      const state = store.getState();

      store.subscribe(() => {
        const newState = store.getState();
        document.querySelector('#immer-value').textContent = newState.nested.deep.value;
      });

      return jsx('div', {
        children: [
          jsx('div', { className: 'count', id: 'immer-value', children: state.nested.deep.value }),
          jsx('button', { onClick: state.updateDeep, children: 'Update Nested Value' }),
          jsx('pre', { children: JSON.stringify(state, null, 2) })
        ]
      });
    });

    // Demo 4: Persist + DevTools
    const usePersistStore = create(
      devtools(
        persist(
          (set) => ({
            count: 0,
            increment: () => set(state => ({ count: state.count + 1 })),
            decrement: () => set(state => ({ count: state.count - 1 }))
          }),
          { name: 'persist-demo' }
        ),
        { name: 'Pydance Demo Store' }
      )
    );

    const PersistDemo = createComponent(() => {
      const store = usePersistStore;
      const state = store.getState();

      store.subscribe(() => {
        const newState = store.getState();
        document.querySelector('#persist-count').textContent = newState.count;
      });

      return jsx('div', {
        children: [
          jsx('div', { className: 'count', id: 'persist-count', children: state.count }),
          jsx('button', { onClick: state.increment, children: '+ Increment' }),
          jsx('button', { onClick: state.decrement, children: '- Decrement' }),
          jsx('p', { children: 'State persists in localStorage. Refresh to see!' })
        ]
      });
    });

    // Mount all demos
    new ZustandDemo().mount('#zustand-demo');
    new RTKDemo().mount('#rtk-demo');
    new ImmerDemo().mount('#immer-demo');
    new PersistDemo().mount('#persist-demo');
  </script>
</body>
</html>
